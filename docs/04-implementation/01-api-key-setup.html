<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIキーの取得と設定 - 医療機関向け API キー管理マニュアル</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="header-title">🔑 APIキーの取得と設定</h1>
                <p class="header-subtitle">医療機関向け API キー管理マニュアル</p>
            </div>
            <div class="header-actions">
                <button onclick="window.print()" class="btn btn-outline">🖨️ 印刷</button>
                <a href="../../index.html" class="btn btn-primary">📚 マニュアル目次に戻る</a>
            </div>
        </div>
    </header>

    <div class="container main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>📚 目次</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">☰</button>
            </div>
            
            <div class="sidebar-content">
                <div class="nav-section" data-section="basics">
                    <div class="nav-section-header">
                        <h4>📖 01. 基本概念</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../01-basics/01-what-is-llm.html">LLMとは</a></li>
                        <li><a href="../01-basics/02-what-is-api.html">APIとは</a></li>
                        <li><a href="../01-basics/03-medical-considerations.html">医療機関での注意点</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="compliance">
                    <div class="nav-section-header">
                        <h4>⚖️ 02. 法規制・コンプライアンス</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../02-compliance/01-japanese-regulations.html">日本の医療機関における法規制</a></li>
                        <li><a href="../02-compliance/02-openai-privacy.html">OpenAIプライバシーポリシー</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🤝 BAA・HIPAA ガイド</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../02-compliance/03-baa-hipaa/01-basics.html">BAA基本概念</a></li>
                                    <li><a href="../02-compliance/03-baa-hipaa/02-zdr.html">ZDR詳細</a></li>
                                    <li><a href="../02-compliance/03-baa-hipaa/03-implementation.html">実装・申請手順</a></li>
                                    <li><a href="../02-compliance/03-baa-hipaa/04-decision-guide.html">意思決定ガイド</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <h4>🛡️ 03. セキュリティ</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../03-security/01-security-overview.html">セキュリティ概要</a></li>
                        <li><a href="../03-security/02-patient-data-protection.html">患者情報保護</a></li>
                        <li><a href="../03-security/03-api-key-security.html">APIキーセキュリティ</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🔍 セキュリティ監査</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../03-security/04-security-audit/01-overview-daily.html">監査概要・日常チェック</a></li>
                                    <li><a href="../03-security/04-security-audit/02-audit-items-tools.html">重点監査項目・ツール</a></li>
                                    <li><a href="../03-security/04-security-audit/03-audit-response-improvement.html">監査対応・改善</a></li>
                                    <li><a href="../03-security/04-security-audit/04-documentation-training.html">文書管理・担当者育成</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="implementation">
                    <div class="nav-section-header">
                        <h4>🔧 04. 実装・運用</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../04-implementation/01-api-key-setup.html">APIキーの取得と設定</a></li>
                        <li><a href="../04-implementation/02-practical-usage.html">実践的な使用ガイド</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🚨 トラブルシューティング</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../04-implementation/03-troubleshooting/01-emergency-technical.html">緊急時対応・技術的問題</a></li>
                                    <li><a href="../04-implementation/03-troubleshooting/02-application-cost.html">アプリケーション・コスト問題</a></li>
                                    <li><a href="../04-implementation/03-troubleshooting/03-maintenance-escalation.html">システム保守・エスカレーション</a></li>
                                    <li><a href="../04-implementation/03-troubleshooting/04-tools-improvement.html">ツール・継続的改善</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">📊 運用管理</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../04-implementation/04-operations-management/01-daily-operations.html">日常運用</a></li>
                                    <li><a href="../04-implementation/04-operations-management/02-user-cost-management.html">利用者・コスト管理</a></li>
                                    <li><a href="../04-implementation/04-operations-management/03-analysis-improvement.html">データ分析・改善</a></li>
                                    <li><a href="../04-implementation/04-operations-management/04-documentation-emergency.html">文書管理・緊急時対応</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="reference">
                    <div class="nav-section-header">
                        <h4>📋 05. リファレンス</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../05-reference/01-quick-reference.html">クイックリファレンス</a></li>
                        <li><a href="../05-reference/02-executive-summary.html">エグゼクティブサマリー</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="training">
                    <div class="nav-section-header">
                        <h4>🎓 06. 研修・トレーニング</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">📚 職員研修プログラム</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../06-training/01-overview.html">研修体系概要</a></li>
                                    <li><a href="../06-training/02-advanced.html">継続・職種別研修</a></li>
                                    <li><a href="../06-training/03-evaluation.html">効果測定・評価</a></li>
                                    <li><a href="../06-training/04-management.html">運営体制・教材管理</a></li>
                                </ul>
                            </div>
                        </li>
                        <li><a href="../06-training/02-assessment-tests.html">理解度テスト問題集</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="reporting">
                    <div class="nav-section-header">
                        <h4>📊 07. レポート・分析</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../07-reporting/01-monthly-reports.html">月次レポートテンプレート</a></li>
                        <li><a href="../07-reporting/02-training-effectiveness.html">研修効果測定レポート</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <main class="content" id="content">
            <h1>APIキーの取得と設定</h1>

            <h2>OpenAIアカウントの作成</h2>

            <h3>🏥 医療機関向けアカウント設定</h3>

            <h4>事前準備</h4>
            <p>医療機関でのOpenAI API利用には、適切なアカウント設定が重要です。</p>

            <h5>必要な情報</h5>
            <div class="card">
                <ul>
                    <li><strong>医療機関名</strong>: 正式な法人名称</li>
                    <li><strong>責任者情報</strong>: 管理者（院長・IT責任者）</li>
                    <li><strong>連絡先</strong>: 代表メールアドレス・電話番号</li>
                    <li><strong>利用目的</strong>: 医療業務での具体的な活用計画</li>
                </ul>
            </div>

            <h5>アカウント種別</h5>
            <div class="card">
                <pre>個人アカウント（非推奨）:
- 個人名での登録
- 個人クレジットカードでの支払い
- 医療機関としての保護が不十分

組織アカウント（推奨）:
- 医療機関名での登録
- 法人カードでの支払い
- 適切なガバナンス体制</pre>
            </div>

            <h3>📝 アカウント作成手順</h3>

            <h4>1. OpenAI公式サイトにアクセス</h4>
            <div class="card">
                <ul>
                    <li>URL: https://platform.openai.com/</li>
                    <li>「Sign up」ボタンをクリック</li>
                </ul>
            </div>

            <h4>2. 基本情報の入力</h4>
            <div class="card">
                <pre>入力項目:
- Email: 医療機関の代表メールアドレス
- Password: 強固なパスワード（大小英数記号12文字以上）
- Organization name: 正式な医療機関名</pre>
            </div>

            <h4>3. メール認証</h4>
            <div class="card">
                <ul>
                    <li>登録メールアドレスに認証メール送信</li>
                    <li>メール内のリンクをクリックして認証完了</li>
                </ul>
            </div>

            <h4>4. 電話番号認証</h4>
            <div class="card">
                <ul>
                    <li>SMS認証による本人確認</li>
                    <li>医療機関の代表番号を推奨</li>
                </ul>
            </div>

            <h2>APIキーの生成</h2>

            <h3>🔑 キー生成の基本手順</h3>

            <h4>1. API Keys ページへアクセス</h4>
            <div class="card">
                <ul>
                    <li>ダッシュボード左メニューから「API Keys」を選択</li>
                    <li>または直接 https://platform.openai.com/api-keys</li>
                </ul>
            </div>

            <h4>2. 新しいキーの作成</h4>
            <div class="card">
                <pre>手順:
1. 「Create new secret key」をクリック
2. キー名を入力（例：「内科外来用」「文書作成用」）
3. 権限設定（通常は「All」を選択）
4. 「Create secret key」をクリック</pre>
            </div>

            <h4>3. キーの保存</h4>
            <div class="alert alert-warning">
                <h5>⚠️ 重要: キーは一度だけ表示されます</h5>
                <pre>表示例:
sk-proj-abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ

このキーを安全に保存してください。
再表示はできません。</pre>
            </div>

            <h3>🏷️ キーの命名規則</h3>

            <h4>推奨命名パターン</h4>
            <div class="card">
                <pre>部署別:
- naika-gairai-2024（内科外来2024年）
- seikei-2024（整形外科2024年）
- kango-2024（看護部2024年）

用途別:
- bunsho-sakusei（文書作成）
- ronsho-youyaku（論文要約）
- kanja-setsumei（患者説明）

期間別:
- 2024-q1（2024年第1四半期）
- 2024-q2（2024年第2四半期）</pre>
            </div>

            <h2>BAA（Business Associate Agreement）の申請</h2>

            <h3>📋 BAA申請の準備</h3>

            <h4>医療機関の場合、BAA申請を強く推奨</h4>
            <p>BAA（Business Associate Agreement）により、より厳格なデータ保護が提供されます。</p>

            <h4>申請前の準備資料</h4>
            <div class="card">
                <pre>必要書類:
1. 医療機関の概要
   - 正式名称・所在地
   - 診療科目・病床数
   - 年間患者数

2. 利用計画書
   - AI活用の目的・範囲
   - 取り扱うデータの種類
   - セキュリティ対策

3. 責任者情報
   - 管理者の詳細情報
   - IT責任者の詳細情報
   - 緊急連絡先</pre>
            </div>

            <h3>📧 BAA申請手順</h3>

            <h4>1. 申請メール送信</h4>
            <div class="card">
                <pre>宛先: baa@openai.com
件名: BAA Request - [医療機関名]

本文例:
件名: Business Associate Agreement申請

OpenAI様

[医療機関名]の[役職][氏名]と申します。

弊院では、診療業務の効率化を目的として、
OpenAI APIの利用を検討しております。

患者情報の適切な保護のため、
Business Associate Agreement（BAA）の
締結をお願いいたします。

＜医療機関情報＞
- 正式名称: [医療機関名]
- 所在地: [住所]
- 診療科目: [科目]
- 責任者: [氏名・役職]

＜利用目的＞
- 診療記録の作成支援
- 患者説明資料の作成
- 医学文献の要約

ご不明な点がございましたら、
お気軽にお問い合わせください。

よろしくお願いいたします。

[署名]</pre>
            </div>

            <h4>2. 追加情報の提供</h4>
            <div class="card">
                <p>OpenAIから追加情報の要求があった場合、迅速に対応</p>
                <ul>
                    <li>より詳細な利用計画</li>
                    <li>セキュリティ体制の説明</li>
                    <li>技術的な質問への回答</li>
                </ul>
            </div>

            <h4>3. BAA締結</h4>
            <div class="card">
                <ul>
                    <li>通常1-2営業日で初回回答</li>
                    <li>数営業日でBAA締結完了</li>
                    <li>ZDR（Zero Data Retention）オプションの利用可能</li>
                </ul>
            </div>

            <h2>請求・支払い設定</h2>

            <h3>💳 支払い方法の設定</h3>

            <h4>推奨支払い方法</h4>
            <div class="card">
                <pre>法人クレジットカード（推奨）:
- 医療機関名義のクレジットカード
- 利用明細の透明性
- 経理処理の簡素化

請求書支払い:
- 月額$1,000以上の場合利用可能
- 銀行振込での支払い
- 法人会計に適した処理</pre>
            </div>

            <h4>請求設定の手順</h4>
            <div class="card">
                <ol>
                    <li><strong>Billing</strong> ページにアクセス</li>
                    <li><strong>Payment methods</strong> で支払い方法を設定</li>
                    <li><strong>Billing information</strong> で請求先情報を入力</li>
                    <li><strong>Usage limits</strong> で利用上限を設定</li>
                </ol>
            </div>

            <h3>💰 利用上限の設定</h3>

            <h4>予算管理のための制限設定</h4>
            <div class="card">
                <pre>推奨設定例:

小規模診療所:
- 月額上限: $50-100
- 1日上限: $10
- アラート: 80%到達時

中規模病院:
- 月額上限: $200-500
- 1日上限: $50
- アラート: 70%到達時

大規模病院:
- 月額上限: $1,000-5,000
- 1日上限: $200
- アラート: 60%到達時</pre>
            </div>

            <h2>APIキーの実装・設定</h2>

            <h3>🔧 システムへの実装</h3>

            <h4>環境変数での設定（推奨）</h4>
            <div class="card">
                <pre># .env ファイル
OPENAI_API_KEY=sk-proj-your-secret-key-here
OPENAI_ORG_ID=org-your-organization-id

# 環境変数の設定
export OPENAI_API_KEY="sk-proj-your-secret-key-here"</pre>
            </div>

            <h4>アプリケーション設定</h4>
            <div class="card">
                <pre># Python例
import openai

# 環境変数から読み込み（推奨）
openai.api_key = os.getenv("OPENAI_API_KEY")

# 直接指定（非推奨）
# openai.api_key = "sk-proj-..." # セキュリティリスクあり</pre>
            </div>

            <h4>設定ファイル（暗号化必須）</h4>
            <div class="card">
                <pre>// config.json（暗号化必須）
{
  "openai": {
    "api_key": "encrypted_key_here",
    "organization": "org-id-here",
    "max_tokens": 1000,
    "temperature": 0.7
  }
}</pre>
            </div>

            <h3>🛡️ セキュアな実装パターン</h3>

            <h4>1. 環境変数 + 暗号化</h4>
            <div class="card">
                <pre>import os
from cryptography.fernet import Fernet

# 暗号化されたキーの復号化
def decrypt_api_key():
    encrypted_key = os.getenv("ENCRYPTED_OPENAI_KEY")
    key = os.getenv("ENCRYPTION_KEY")
    f = Fernet(key)
    return f.decrypt(encrypted_key.encode()).decode()

# 安全にAPIキーを取得
api_key = decrypt_api_key()</pre>
            </div>

            <h4>2. アクセス制御付きの設定</h4>
            <div class="card">
                <pre>class SecureAPIConfig:
    def __init__(self):
        self._api_key = None
        self._authorized_users = set()
    
    def authorize_user(self, user_id):
        # ユーザー認証ロジック
        if self.verify_user(user_id):
            self._authorized_users.add(user_id)
    
    def get_api_key(self, user_id):
        if user_id in self._authorized_users:
            return self._load_encrypted_key()
        else:
            raise UnauthorizedError("User not authorized")</pre>
            </div>

            <h2>テスト・動作確認</h2>

            <h3>🧪 基本動作テスト</h3>

            <h4>1. 接続テスト</h4>
            <div class="card">
                <pre>import openai

try:
    # 簡単なAPI呼び出し
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": "Hello, this is a test."}],
        max_tokens=10
    )
    print("接続成功:", response.choices[0].message.content)
except Exception as e:
    print("接続エラー:", str(e))</pre>
            </div>

            <h4>2. 権限テスト</h4>
            <div class="card">
                <pre># 利用可能なモデルの確認
models = openai.Model.list()
print("利用可能なモデル:")
for model in models.data:
    print(f"- {model.id}")</pre>
            </div>

            <h4>3. 利用量テスト</h4>
            <div class="card">
                <pre># 少量のテストデータで動作確認
test_messages = [
    "これはテストメッセージです。",
    "APIの動作確認を行っています。",
    "正常に動作していることを確認してください。"
]

for msg in test_messages:
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": msg}],
        max_tokens=50
    )
    print(f"入力: {msg}")
    print(f"出力: {response.choices[0].message.content}\n")</pre>
            </div>

            <h3>📊 監視・ログ設定</h3>

            <h4>利用状況の記録</h4>
            <div class="card">
                <pre>import logging
from datetime import datetime

# ログ設定
logging.basicConfig(
    filename='openai_usage.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

def log_api_usage(user_id, model, tokens_used, cost):
    log_entry = {
        'timestamp': datetime.now().isoformat(),
        'user_id': user_id,
        'model': model,
        'tokens': tokens_used,
        'cost': cost
    }
    logging.info(f"API_USAGE: {log_entry}")</pre>
            </div>

            <h2>トラブルシューティング</h2>

            <h3>❗ よくある問題と解決方法</h3>

            <h4>1. 認証エラー</h4>
            <div class="alert alert-danger">
                <pre>エラー: "Incorrect API key provided"

解決方法:
- APIキーの形式確認（sk-proj-で始まる）
- コピー時の余分な文字・空白の削除
- 環境変数の設定確認</pre>
            </div>

            <h4>2. 権限エラー</h4>
            <div class="alert alert-danger">
                <pre>エラー: "You exceeded your current quota"

解決方法:
- 利用上限の確認・増額
- 請求情報の更新
- 支払い方法の確認</pre>
            </div>

            <h4>3. 接続エラー</h4>
            <div class="alert alert-danger">
                <pre>エラー: "Connection timeout"

解決方法:
- ネットワーク接続の確認
- ファイアウォール設定の確認
- プロキシ設定の確認</pre>
            </div>

            <div class="page-navigation">
                <a href="../03-security/03-api-key-security.html" class="page-nav-btn">← 前：APIキーセキュリティ</a>
                <div class="page-nav-center">
                    <a href="../../index.html">📚 目次</a>
                </div>
                <a href="02-practical-usage.html" class="page-nav-btn">次：実践ガイド →</a>
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 医療機関向け API キー管理マニュアル. 
            <span class="footer-note">本マニュアルは医療機関での安全なAI活用を支援することを目的としています。</span></p>
        </div>
    </footer>

    <script src="../assets/js/sidebar.js"></script>
    <script>
    </script>
</body>
</html>