<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>セキュリティ監査ガイド - 重点監査項目と監査ツール - 医療機関向け API キー管理マニュアル</title>
    <link rel="stylesheet" href="../../../assets/css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <h1 class="header-title">🎯 セキュリティ監査ガイド - 重点監査項目と監査ツール</h1>
                <p class="header-subtitle">医療機関向け API キー管理マニュアル</p>
            </div>
            <div class="header-actions">
                <button onclick="window.print()" class="btn btn-outline">🖨️ 印刷</button>
                <button id="dark-mode-toggle" class="btn btn-outline">🌙</button>
                <a href="../../../index.html" class="btn btn-primary">📚 マニュアル目次に戻る</a>
            </div>
        </div>
    </header>

    <div class="container main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>📚 目次</h3>
                <button id="sidebar-toggle" class="sidebar-toggle">☰</button>
            </div>
            
            <div class="sidebar-content">
                <div class="nav-section" data-section="basics">
                    <div class="nav-section-header">
                        <h4>📖 01. 基本概念</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../01-basics/01-what-is-llm.html">LLMとは</a></li>
                        <li><a href="../../01-basics/02-what-is-api.html">APIとは</a></li>
                        <li><a href="../../01-basics/03-medical-considerations.html">医療機関での注意点</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="compliance">
                    <div class="nav-section-header">
                        <h4>⚖️ 02. 法規制・コンプライアンス</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../02-compliance/01-japanese-regulations.html">日本の医療機関における法規制</a></li>
                        <li><a href="../../02-compliance/02-openai-privacy.html">OpenAIプライバシーポリシー</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🤝 BAA・HIPAA ガイド</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../../02-compliance/03-baa-hipaa/01-basics.html">BAA基本概念</a></li>
                                    <li><a href="../../02-compliance/03-baa-hipaa/02-zdr.html">ZDR詳細</a></li>
                                    <li><a href="../../02-compliance/03-baa-hipaa/03-implementation.html">実装・申請手順</a></li>
                                    <li><a href="../../02-compliance/03-baa-hipaa/04-decision-guide.html">意思決定ガイド</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="security">
                    <div class="nav-section-header">
                        <h4>🛡️ 03. セキュリティ</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../03-security/01-security-overview.html">セキュリティ概要</a></li>
                        <li><a href="../../03-security/02-patient-data-protection.html">患者情報保護</a></li>
                        <li><a href="../../03-security/03-api-key-security.html">APIキーセキュリティ</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🔍 セキュリティ監査</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../../03-security/04-security-audit/01-overview-daily.html">監査概要・日常チェック</a></li>
                                    <li><a href="../../03-security/04-security-audit/02-audit-items-tools.html">重点監査項目・ツール</a></li>
                                    <li><a href="../../03-security/04-security-audit/03-audit-response-improvement.html">監査対応・改善</a></li>
                                    <li><a href="../../03-security/04-security-audit/04-documentation-training.html">文書管理・担当者育成</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="implementation">
                    <div class="nav-section-header">
                        <h4>🔧 04. 実装・運用</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../04-implementation/01-api-key-setup.html">APIキーの取得と設定</a></li>
                        <li><a href="../../04-implementation/02-practical-usage.html">実践的な使用ガイド</a></li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">🚨 トラブルシューティング</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../../04-implementation/03-troubleshooting/01-emergency-technical.html">緊急時対応・技術的問題</a></li>
                                    <li><a href="../../04-implementation/03-troubleshooting/02-application-cost.html">アプリケーション・コスト問題</a></li>
                                    <li><a href="../../04-implementation/03-troubleshooting/03-maintenance-escalation.html">システム保守・エスカレーション</a></li>
                                    <li><a href="../../04-implementation/03-troubleshooting/04-tools-improvement.html">ツール・継続的改善</a></li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">📊 運用管理</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../../04-implementation/04-operations-management/01-daily-operations.html">日常運用</a></li>
                                    <li><a href="../../04-implementation/04-operations-management/02-user-cost-management.html">利用者・コスト管理</a></li>
                                    <li><a href="../../04-implementation/04-operations-management/03-analysis-improvement.html">データ分析・改善</a></li>
                                    <li><a href="../../04-implementation/04-operations-management/04-documentation-emergency.html">文書管理・緊急時対応</a></li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="nav-section" data-section="reference">
                    <div class="nav-section-header">
                        <h4>📋 05. リファレンス</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../05-reference/01-quick-reference.html">クイックリファレンス</a></li>
                        <li><a href="../../05-reference/02-executive-summary.html">エグゼクティブサマリー</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="training">
                    <div class="nav-section-header">
                        <h4>🎓 06. 研修・トレーニング</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li>
                            <div class="nav-subsection-group">
                                <span class="nav-subsection-title">📚 職員研修プログラム</span>
                                <ul class="nav-subsection-items">
                                    <li><a href="../../06-training/01-overview.html">研修体系概要</a></li>
                                    <li><a href="../../06-training/02-advanced.html">継続・職種別研修</a></li>
                                    <li><a href="../../06-training/03-evaluation.html">効果測定・評価</a></li>
                                    <li><a href="../../06-training/04-management.html">運営体制・教材管理</a></li>
                                </ul>
                            </div>
                        </li>
                        <li><a href="../../06-training/02-assessment-tests.html">理解度テスト問題集</a></li>
                    </ul>
                </div>

                <div class="nav-section" data-section="reporting">
                    <div class="nav-section-header">
                        <h4>📊 07. レポート・分析</h4>
                        <span class="nav-section-toggle">▼</span>
                    </div>
                    <ul class="nav-subsection">
                        <li><a href="../../07-reporting/01-monthly-reports.html">月次レポートテンプレート</a></li>
                        <li><a href="../../07-reporting/02-training-effectiveness.html">研修効果測定レポート</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <main class="content" id="content">
            <h1>セキュリティ監査ガイド - 重点監査項目と監査ツール</h1>

            <h2>🎯 重点監査項目</h2>

            <h3>患者情報保護</h3>

            <h4>データ投入チェック</h4>
            <div class="alert alert-danger">
                <h5>監査手順:</h5>
                <div class="code-block">
                    <pre><code>1. 入力データの抽出・確認
   - AIへの入力履歴の全件確認
   - 個人識別情報の含有チェック
   - 匿名化処理の適切性確認

2. 問題データの特定
   検索対象キーワード:
   - 患者氏名（姓・名のパターン）
   - 生年月日（YYYY/MM/DD、YYYY-MM-DD等）
   - 住所情報（都道府県、市区町村名）
   - 診察券番号、カルテ番号
   - 電話番号、メールアドレス

3. 発見時の対応
   - 即座のシステム利用停止
   - 管理者への緊急報告
   - OpenAIへのデータ削除要請
   - 再発防止策の策定</code></pre>
                </div>
            </div>

            <h4>出力データ管理</h4>
            <div class="card">
                <h5>確認項目:</h5>
                <div class="code-block">
                    <pre><code>- [ ] AI出力の保存場所が適切
- [ ] アクセス権限が制限されている
- [ ] バックアップデータが保護されている
- [ ] 不要データの削除が実施されている

管理状況:
出力データ保存場所: __________________
アクセス可能者数: ______名
データ保持期間: ______ヶ月
最終削除実行日: ____年____月____日</code></pre>
                </div>
            </div>

            <h3>APIキー管理</h3>

            <h4>キーセキュリティ</h4>
            <div class="card">
                <h5>確認項目:</h5>
                <div class="code-block">
                    <pre><code>- [ ] キーの保存方法が適切（暗号化等）
- [ ] 不要なキーが削除されている
- [ ] キーの定期更新が実施されている
- [ ] 利用制限が適切に設定されている

キー管理状況:
有効キー数: ______個
最終更新日: ____年____月____日
利用制限設定: □有 □無
使用中キー数: ______個</code></pre>
                </div>
            </div>

            <h4>アクセス制御</h4>
            <div class="card">
                <h5>確認項目:</h5>
                <div class="code-block">
                    <pre><code>- [ ] キーへのアクセスが制限されている
- [ ] 管理者権限が適切に設定
- [ ] ログが適切に記録されている
- [ ] 異常アクセスの検出機能が動作

アクセス制御:
キー管理権限者: ______名
アクセスログ保持期間: ______ヶ月
異常検出アラート: □有効 □無効
最終権限見直し日: ____年____月____日</code></pre>
                </div>
            </div>

            <h2>📊 監査ツールと手法</h2>

            <h3>自動監査ツール</h3>

            <h4>ログ分析ツール</h4>
            <div class="code-block">
                <pre><code># ログ分析の例（Python）
import re
import json
from datetime import datetime

def analyze_api_logs(log_file):
    """ＡＰＩ利用ログの分析"""
    
    personal_info_patterns = [
        r'\b\d{4}[-/]\d{1,2}[-/]\d{1,2}\b',  # 日付パターン
        r'\b\d{3}-\d{4}-\d{4}\b',            # 電話番号パターン
        r'[a-zA-Z0-9]+@[a-zA-Z0-9]+\.[a-zA-Z]{2,}',  # メールパターン
    ]
    
    violations = []
    
    with open(log_file, 'r', encoding='utf-8') as f:
        for line_num, line in enumerate(f, 1):
            for pattern in personal_info_patterns:
                if re.search(pattern, line):
                    violations.append({
                        'line': line_num,
                        'pattern': pattern,
                        'content': line.strip()
                    })
    
    return violations

# 使用例
violations = analyze_api_logs('api_usage.log')
if violations:
    print(f"⚠️ 警告: {len(violations)}件の個人情報含有疑いを検出")
    for v in violations:
        print(f"行{v['line']}: {v['content'][:50]}...")</code></pre>
            </div>

            <h4>コスト監視スクリプト</h4>
            <div class="code-block">
                <pre><code># コスト監視の例
import requests
import os
from datetime import datetime, timedelta

def check_cost_anomaly():
    """コスト異常の検出"""
    
    api_key = os.getenv('OPENAI_API_KEY')
    headers = {'Authorization': f'Bearer {api_key}'}
    
    # 過去7日間のコスト取得
    end_date = datetime.now()
    start_date = end_date - timedelta(days=7)
    
    url = f"https://api.openai.com/v1/usage?start_date={start_date.strftime('%Y-%m-%d')}&end_date={end_date.strftime('%Y-%m-%d')}"
    
    response = requests.get(url, headers=headers)
    usage_data = response.json()
    
    # 異常検出ロジック
    daily_costs = [day['cost'] for day in usage_data.get('data', [])]
    average_cost = sum(daily_costs) / len(daily_costs) if daily_costs else 0
    
    for i, cost in enumerate(daily_costs):
        if cost > average_cost * 2:  # 平均の2倍を異常とする
            print(f"⚠️ コスト異常検出: {start_date + timedelta(days=i)} - ${cost}")
            
    return daily_costs</code></pre>
            </div>

            <h3>手動監査チェックシート</h3>

            <h4>現場監査チェックシート</h4>
            <div class="card">
                <h5>現場監査実施記録</h5>
                <div class="code-block">
                    <pre><code>実施日: ____年____月____日
実施者: __________________
対象部署: ________________

物理的セキュリティ:
- [ ] PCの画面ロック設定確認
- [ ] APIキー記載メモの有無確認
- [ ] 第三者の画面のぞき見対策確認
- [ ] USBメモリ等の持ち込み状況確認

操作確認:
- [ ] 適切なログイン手順の実施
- [ ] 個人情報入力の回避
- [ ] AI出力の適切な確認・修正
- [ ] ログアウト手順の実施

教育状況:
- [ ] 利用ガイドラインの理解度
- [ ] セキュリティ意識の確認
- [ ] 緊急時対応の理解度
- [ ] 最新研修の受講状況

特記事項:
_________________________________
_________________________________</code></pre>
                </div>
            </div>

            <h2>監査ツール活用の実践例</h2>

            <h3>事例1: 個人情報漏洩リスクの検出</h3>
            <div class="card">
                <h4>状況:</h4>
                <p>週次ログ分析で個人情報の可能性があるデータの投入を検出</p>
                
                <h4>検出内容:</h4>
                <div class="code-block">
                    <pre><code>検出時刻: 2025年6月20日 14:30
検出パターン: 電話番号形式 (03-1234-5678)
投入部門: 内科外来
利用者: 看護師A

ログ分析結果:
⚠️ 警告: 1件の個人情報含有疑いを検出
行245: "患者様の連絡先 03-1234-5678 に確認..."</code></pre>
                </div>

                <h4>対応措置:</h4>
                <div class="code-block">
                    <pre><code>1. 即座の対応（検出から15分）
   - 該当利用者への緊急連絡
   - 入力内容の詳細確認
   - システム利用の一時停止

2. 詳細調査（30分後）
   - 実際の電話番号かどうか確認
   - 他の個人情報含有の確認
   - 影響範囲の特定

3. 対策実施（1時間後）
   - OpenAIへの削除要請
   - 再発防止の教育実施
   - 監視機能の強化

結果: 架空の番号であることが判明、教育強化で対応完了</code></pre>
                </div>
            </div>

            <h3>事例2: コスト異常の早期検出</h3>
            <div class="card">
                <h4>状況:</h4>
                <p>自動監視スクリプトが通常の3倍のコスト増加を検出</p>
                
                <h4>検出内容:</h4>
                <div class="code-block">
                    <pre><code>検出日: 2025年6月18日
通常コスト: $45/日
異常コスト: $135/日（300%増）
異常期間: 13:00-17:00

詳細分析:
- 特定ユーザーによる大量利用
- プロンプト長: 平均3,000文字（通常800文字）
- 繰り返し処理: 同一内容を50回実行</code></pre>
                </div>

                <h4>原因調査と対応:</h4>
                <div class="code-block">
                    <pre><code>1. 原因特定
   - 新任者がテスト目的で大量実行
   - プロンプト最適化の知識不足
   - 利用制限の認識不足

2. 対応策
   - 利用制限の設定強化
   - 新任者向け追加研修の実施
   - プロンプト最適化ガイドの配布

3. 予防策
   - 利用量アラートの設定
   - 新任者向けチュートリアル
   - 定期的な利用状況レビュー

効果: 翌日から正常なコストレベルに復帰</code></pre>
                </div>
            </div>

            <div class="page-navigation">
                <a href="01-overview-daily.html" class="page-nav-btn">← 前：監査概要と日常チェックリスト</a>
                <div class="page-nav-center">
                    <a href="../../../index.html">📚 目次</a>
                </div>
                <a href="03-audit-response-improvement.html" class="page-nav-btn">次：監査対応と継続的改善 →</a>
            </div>
        </main>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 医療機関向け API キー管理マニュアル. 
            <span class="footer-note">本マニュアルは医療機関での安全なAI活用を支援することを目的としています。</span></p>
        </div>
    </footer>

    <script src="../../assets/js/sidebar.js"></script>
    <script>
        // ダークモード切り替え
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        if (darkModeToggle) {
            darkModeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                
                darkModeToggle.textContent = newTheme === 'dark' ? '☀️' : '🌙';
            });
        }

        // 保存されたテーマを復元
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            document.documentElement.setAttribute('data-theme', savedTheme);
            if (darkModeToggle) {
                darkModeToggle.textContent = savedTheme === 'dark' ? '☀️' : '🌙';
            }
        }
    </script>
</body>
</html>